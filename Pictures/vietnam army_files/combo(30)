YUI.add("hermes-template-photo-well-media-scrappy",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,l,n){var i,s=null!=a?a:{};return'\t<div class="restricted-interstitial">\n\t\t<div class="restricted-interstitial-message">\n\t\t\t<h2>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:n}))+"</h2>\n"+(null!=(i=e.if.call(s,null!=a?a.isSignedIn:a,{name:"if",hash:{},fn:t.program(2,n,0),inverse:t.program(5,n,0),data:n}))?i:"")+"\t\t</div>\n\t</div>\n"},2:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return"\t\t\t\t<p>"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:n}))+"<br />"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:n}))+"</p>\n\n"+(null!=(i=e.unless.call(s,null!=a?a.isMinor:a,{name:"unless",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?i:"")},3:function(t,a,e,l,n){var i=null!=a?a:{},s=e.helperMissing,h=t.escapeExpression;return"\t\t\t\t\t<p><button class='ui-button'><span>"+h((e.intlMessage||a&&a.intlMessage||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:n}))+"</span></button></p>\n\t\t\t\t\t<p>"+h((e.intlHTMLMessage||a&&a.intlHTMLMessage||s).call(i,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:n}))+"</p>\n"},5:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return"\t\t\t\t<p>"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:n}))+' <a href="//'+r("function"==typeof(i=null!=(i=e.host||(null!=a?a.host:a))?i:h)?i.call(s,{name:"host",hash:{},data:n}):i)+'/signin/" data-track="photoWellSignInClick">'+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:n}))+"</a></p>\n"},7:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.isVideo:a,{name:"if",hash:{},fn:t.program(8,n,0),inverse:t.program(10,n,0),data:n}))?i:""},8:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return'\t\t<div class="videoplayer main-photo" style="width:'+r("function"==typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)?i.call(s,{name:"width",hash:{},data:n}):i)+"px; height:"+r("function"==typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)?i.call(s,{name:"height",hash:{},data:n}):i)+'px;"><video id="video_1" poster="'+r("function"==typeof(i=null!=(i=e.src||(null!=a?a.src:a))?i:h)?i.call(s,{name:"src",hash:{},data:n}):i)+'" class="video-js vjs-big-play-centered inherit-size"></video></div>\n'},10:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.showFuzzy:a,{name:"if",hash:{},fn:t.program(11,n,0),inverse:t.program(13,n,0),data:n}))?i:""},11:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return'\t\t\t<span class="restricted-image main-photo" style="width:'+r("function"==typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)?i.call(s,{name:"width",hash:{},data:n}):i)+"px;height:"+r("function"==typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)?i.call(s,{name:"height",hash:{},data:n}):i)+'px;"></span>\n'},13:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r="function",o=t.escapeExpression;return'\t\t\t<span class="facade-of-protection-neue" style="width:'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+"px;height:"+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'px;">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||h).call(s,null!=a?a["zoom-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||h).call(s,null!=a?a["vr-overlay-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\t\t\t</span>\n\n\t\t\t<img width="'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.src||(null!=a?a.src:a))?i:h)===r?i.call(s,{name:"src",hash:{},data:n}):i)+'" class="low-res-photo" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t\t<img width="'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.highResSrc||(null!=a?a.highResSrc:a))?i:h)===r?i.call(s,{name:"highResSrc",hash:{},data:n}):i)+'" class="main-photo is-hidden" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t\t<script nonce="'+o(typeof(i=null!=(i=e.cspNonce||(null!=a?a.cspNonce:a))?i:h)===r?i.call(s,{name:"cspNonce",hash:{},data:n}):i)+"\">\n\t\t\t\tvar img = document.querySelector('.photo-well-media-scrappy-view img.main-photo');\n\t\t\t\timg.onload = function () { registerFirstPhoto(img); };\n\t\t\t<\/script>\n\t\t\t<noscript>\n\t\t\t\t<img width=\""+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.highResSrc||(null!=a?a.highResSrc:a))?i:h)===r?i.call(s,{name:"highResSrc",hash:{},data:n}):i)+'" class="main-photo" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t\t</noscript>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.needsInterstitial:a,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(7,n,0),data:n}))?i:""},useData:!0}),l={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(l[a]=e)}),t.Template.register("hermes/photo-well-media-scrappy",function(a,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,e(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-moola-view",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,r){return'\t\t\t\t\t\t<a target="_blank" href="/account/upgrade/pro" title="Flickr Pro">Flickr Pro</a>\n'},3:function(t,a,e,n,r){return'\t\t\t\t\t\t<a href="#" class="sponsored-title" title="Sponsored Advertiser">Sponsored Advertiser</a>\n'},5:function(t,a,e,n,r){return'\t\t\t\t\t\t\t<a target="_blank" href="/account/upgrade/pro">Sign up today!</a>\n'},7:function(t,a,e,n,r){return'\t\t\t\t\t\t\t<a target="_blank" href="https://help.flickr.com/en_us/ad-free-browsing-sharing-SJxW22miyX">Learn more about ads</a>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,e,n,r){var i,o,s=null!=a?a:{};return'<div class="sub-photo-container centered-content">\n\t<div class="sub-photo-content-container">\n\t\t<div class="view sub-photo-left-view">\n\t\t\t<div class="attribution-view photo-attribution">\n\t\t\t\t<a class="attribution-icon no-menu circle-icon" href="#" data-track="ad_link_rail_icon" target="_blank">\n\t\t\t\t\t<img src="'+t.escapeExpression("function"==typeof(o=null!=(o=e.assetRoot||(null!=a?a.assetRoot:a))?o:e.helperMissing)?o.call(s,{name:"assetRoot",hash:{},data:r}):o)+'/images/general/moola.png"/>\n\t\t\t\t</a>\n\n\t\t\t\t<div class="attribution-info">\n'+(null!=(i=e.if.call(s,null!=a?a.isProUpsell:a,{name:"if",hash:{},fn:t.program(1,r,0),inverse:t.program(3,r,0),data:r}))?i:"")+'\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="view sub-photo-title-desc-view" id="yui_3_16_0_rc_1_1_1401741750198_2372">\n\t\t\t\t<div class="title-desc-block">\n\t\t\t\t\t<span class=" meta-field photo-title ">\n'+(null!=(i=e.if.call(s,null!=a?a.isProUpsell:a,{name:"if",hash:{},fn:t.program(5,r,0),inverse:t.program(7,r,0),data:r}))?i:"")+'\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="view sub-photo-right-view">\n\t\t\t<a href="/account/upgrade/pro" class="find-out-more" data-track="ad_link_rail_panel" target="_blank">\n\t\t\t\tAd free browsing? Sign up for Flickr Pro\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),n={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)}),t.Template.register("hermes/sub-photo-moola-view",function(a,r){return r=r||{},r.partials=r.partials?t.merge(n,r.partials):n,e(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-prbd-moola-position",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,t){return"upsell-fallback"},3:function(a,e,n,l,t){return'\t\t<a href="/account/upgrade/pro?feed"></a>\n'},5:function(a,e,n,l,t){var s;return null!=(s=(n.isFlipped||e&&e.isFlipped||n.helperMissing).call(null!=e?e:{},"enable-ad-timer-lock",{name:"isFlipped",hash:{},fn:a.program(6,t,0),inverse:a.noop,data:t}))?s:""},6:function(a,e,n,l,t){return'\t\t<div class="navad-timer-container">\n\t\t\t<p class="navad-timer-text">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{adTimerStartCount:null!=e?e.adTimerStartCount:e,intlName:"common.AD_INTERSTITIAL_TIMER"},data:t}))+"</p>\n\t\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,t){var s,i,r=null!=e?e:{},o=n.helperMissing,p=a.escapeExpression;return'<div data-aaad="true" data-aa-adunit="'+p("function"==typeof(i=null!=(i=n.adUnit||(null!=e?e.adUnit:e))?i:o)?i.call(r,{name:"adUnit",hash:{},data:t}):i)+'" class="moola-container '+p("function"==typeof(i=null!=(i=n.class||(null!=e?e.class:e))?i:o)?i.call(r,{name:"class",hash:{},data:t}):i)+" "+(null!=(s=n.if.call(r,null!=e?e.upsellFallback:e,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?s:"")+'">\n'+(null!=(s=n.if.call(r,null!=e?e.upsellFallback:e,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.noop,data:t}))?s:"")+'</div>\n<p class="upgrade-to-pro-cta"><a href="/account/upgrade/pro">'+p((n.intlMessage||e&&e.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"common.UPGRADE_PRO_HIDE_ADS"},data:t}))+"</a></p>\n"+(null!=(s=n.if.call(r,null!=e?e.signedOut:e,{name:"if",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?s:"")},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/prbd-moola-position",function(e,t){return t=t||{},t.partials=t.partials?a.merge(l,t.partials):l,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-google-moola-position",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,l,t){return"upsell-fallback"},3:function(a,e,n,l,t){var i;return"width: "+a.escapeExpression("function"==typeof(i=null!=(i=n.adWidth||(null!=e?e.adWidth:e))?i:n.helperMissing)?i.call(null!=e?e:{},{name:"adWidth",hash:{},data:t}):i)+"px;"},5:function(a,e,n,l,t){var i;return"height: "+a.escapeExpression("function"==typeof(i=null!=(i=n.adHeight||(null!=e?e.adHeight:e))?i:n.helperMissing)?i.call(null!=e?e:{},{name:"adHeight",hash:{},data:t}):i)+"px;"},7:function(a,e,n,l,t){return'\t\t<a href="/account/upgrade/pro?feed"></a>\n'},9:function(a,e,n,l,t){var i;return null!=(i=(n.isFlipped||e&&e.isFlipped||n.helperMissing).call(null!=e?e:{},"enable-ad-timer-lock",{name:"isFlipped",hash:{},fn:a.program(10,t,0),inverse:a.noop,data:t}))?i:""},10:function(a,e,n,l,t){return'\t\t<div class="navad-timer-container">\n\t\t\t<p class="navad-timer-text">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{adTimerStartCount:null!=e?e.adTimerStartCount:e,intlName:"common.AD_INTERSTITIAL_TIMER"},data:t}))+"</p>\n\t\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,l,t){var i,s,r=null!=e?e:{},o=n.helperMissing,p=a.escapeExpression;return'<div class="moola-container '+p("function"==typeof(s=null!=(s=n.class||(null!=e?e.class:e))?s:o)?s.call(r,{name:"class",hash:{},data:t}):s)+" "+(null!=(i=n.if.call(r,null!=e?e.upsellFallback:e,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?i:"")+"\" id='"+p("function"==typeof(s=null!=(s=n.adDiv||(null!=e?e.adDiv:e))?s:o)?s.call(r,{name:"adDiv",hash:{},data:t}):s)+"' style='"+(null!=(i=n.if.call(r,null!=e?e.adWidth:e,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.noop,data:t}))?i:"")+" "+(null!=(i=n.if.call(r,null!=e?e.adHeight:e,{name:"if",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?i:"")+"'>\n"+(null!=(i=n.if.call(r,null!=e?e.upsellFallback:e,{name:"if",hash:{},fn:a.program(7,t,0),inverse:a.noop,data:t}))?i:"")+'</div>\n<p class="upgrade-to-pro-cta"><a href="/account/upgrade/pro">'+p((n.intlMessage||e&&e.intlMessage||o).call(r,{name:"intlMessage",hash:{intlName:"common.UPGRADE_PRO_HIDE_ADS"},data:t}))+"</a></p>\n"+(null!=(i=n.if.call(r,null!=e?e.signedOut:e,{name:"if",hash:{},fn:a.program(9,t,0),inverse:a.noop,data:t}))?i:"")},useData:!0}),l={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(l[e]=n)}),a.Template.register("hermes/google-moola-position",function(e,t){return t=t||{},t.partials=t.partials?a.merge(l,t.partials):l,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-well-media-interstitial-moola",function(a,e){var l=a.Template.Handlebars.revive({1:function(a,e,l,t,i){var o;return null!=(o=a.invokePartial(t["prbd-moola-position"],e,{name:"prbd-moola-position",hash:{signedOut:null!=e?e.signedOut:e,upsellFallback:null!=e?e.upsellFallback:e,adWidth:null!=e?e.adWidth:e,adHeight:null!=e?e.adHeight:e,adUnit:null!=e?e.adUnit:e,adTimerStartCount:null!=e?e.adTimerStartCount:e},data:i,indent:"\t\t",helpers:l,partials:t,decorators:a.decorators}))?o:""},3:function(a,e,l,t,i){var o;return null!=(o=a.invokePartial(t["google-moola-position"],e,{name:"google-moola-position",hash:{signedOut:null!=e?e.signedOut:e,upsellFallback:null!=e?e.upsellFallback:e,adWidth:null!=e?e.adWidth:e,adHeight:null!=e?e.adHeight:e,adDiv:null!=e?e.adDiv:e,adTimerStartCount:null!=e?e.adTimerStartCount:e},data:i,indent:"\t\t",helpers:l,partials:t,decorators:a.decorators}))?o:""},compiler:[7,">= 4.0.0"],main:function(a,e,l,t,i){var o;return'<div class="photo-page-i-m-container">\n'+(null!=(o=(l.isFlipped||e&&e.isFlipped||l.helperMissing).call(null!=e?e:{},"enable-prebid-ads",{name:"isFlipped",hash:{},fn:a.program(1,i,0),inverse:a.program(3,i,0),data:i}))?o:"")+"</div>\n"},usePartial:!0,useData:!0}),t={};a.Array.each(["prbd-moola-position","google-moola-position"],function(e){var l=a.Template.get("hermes/"+e);l&&(t[e]=l)}),a.Template.register("hermes/photo-well-media-interstitial-moola",function(e,i){return i=i||{},i.partials=i.partials?a.merge(t,i.partials):t,l(e,i)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-prbd-moola-position","hermes-template-google-moola-position"]});YUI.add("photo-well-media-scrappy-view",function(e,t){var i,o=require("hermes-core/flog")(t);i={photo:{render:function(){var e,t,i,o=this,n=this.get("photo"),s="";return o.preloadImage&&(o.preloadImage.onload=null),this.appContext.forceServerRender?t=e=this.getPhotoForDisplay({canvas:{width:Number.MAX_VALUE,height:Number.MAX_VALUE}}):(e=this.getPhotoForDisplay(),t=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]})),n.getValue("owner")&&(s=""===n.getValue("title").trim()?this.intlMessage({intlName:"common.UNTITLED"}):n.getValue("title"),s+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),(i=this.get("container").one(".main-photo"))&&parseInt(i.getAttribute("width"),10)===e.width&&parseInt(i.getAttribute("height"),10)===e.height||this.setContainerWithTemplate("photo-well-media-scrappy",{width:e.width,height:e.height,src:t.url,highResSrc:e.url,imgAltText:s,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:!1,isMinor:this.appContext.getViewer().isMinor}),YUI.Env.isServer?(this.serverWidth=e.width,this.serverHeight=e.height):n.getValue("needsInterstitial")||(o.preloadImage=new Image,o.preloadImage.onload=function(){if(!this.onloadFired&&o.isActiveAndInDOM()){this.onloadFired=!0;var e=o.get("container").one(".low-res-photo");o.get("container").one(".main-photo").removeClass("is-hidden").show(),e.hide()}},o.preloadImage.src=e.url,o.preloadImage.complete&&o.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]}),i=t.url;return this.appContext.flipper.isFlipped("disable-video-playback")&&(i="/images/en-us/video-unavailable.png"),!this.player||e.getValue("isVideoPending")||e.getValue("isVideoFailed")?(this.setContainerWithTemplate("photo-well-media-scrappy",{width:t.width,height:t.height,src:i,needsInterstitial:e.getValue("needsInterstitial"),isVideo:!0,isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this):(e.getValue("isVideoPending")||e.getValue("isVideoFailed")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){var t=e.config.flickr.moola.positions.interstitials[0],i={},o=this.appContext.viewportData.getWidth(),n=e.config.flickr.moola.ad_breakpoint_mobile_desktop;return this.adId=e.guid(),i.adDiv=t.ad_div,i.signedOut=!this.appContext.getViewer().signedIn,i.adTimerStartCount=t.ad_timer_start_value,i.adUnit=t[o<n?"ad_unit_mobile":"ad_unit_desktop"],1===t.ad_sizes.length&&(i.upsellFallback=!1,i.adHeight=t.ad_sizes[0].ad_height,i.adWidth=t.ad_sizes[0].ad_width),this.setContainerWithTemplate("photo-well-media-interstitial-moola",i),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"vr-overlay-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,destinationContainer:".photo-well-media-scrappy-view",disabled:function(){return!this.appContext.flipper.isFlipped("enable-vr")}}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.adSlots=[],""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(i){if(t.set("photo",i),i.getValue("isVideo"))return new e.Promise(function(t,i){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):this.get("photo").getValue("isVideo")?i.video.render.call(this):i.photo.render.call(this),!YUI.Env.isServer&&this.subviews["vr-overlay-view"]&&this.subviews["vr-overlay-view"].get("canVr")&&(this.canVR=!0,this.subviews["zoom-view"]&&this.subviews["zoom-view"].destroy({remove:!0})),this.get("photo").getValue("needsInterstitial")?this.get("container").addClass("has-interstitial"):this.get("container").removeClass("has-interstitial"),this},handleInterstitialDismissButtonClick:function(t){var i=this,n=this.get("personPreferences"),s=this.get("photo"),a=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),n.setValue("safeSearch",a),n.registry.remoteUpdate(i.appContext.auth.user.nsid).then(function(e){s.registry.attributeSearch({needsInterstitial:!0}).forEach(function(e){s.registry.getValue(e,"safetyLevel")<=n.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),i.buildContainer(),i.fire("subviewViewEvent","photoWellResized")},function(e){o.error({err:e}),i.onError(i.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},onParentViewEvent:function(e,t){t&&"photoWellResized"===t[0]&&(this.get("photo").getValue("needsInterstitial")||(this.set("canvasSizeIsDirty",!0),this.buildContainer()))},activate:function(){var t=this,i=e.config.flickr.moola.positions.interstitials[0];return!this.get("photo").getValue("isVideo")||this.get("photo").getValue("isVideoPending")||this.get("photo").getValue("isVideoFailed")||(this.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1").getDOMNode():null,controlBar:{fullscreenToggle:!1}}),this.player.init(),this.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",this.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.get("container").one(".restricted-interstitial-message button")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this.isAd&&(this.appContext.flipper.isFlipped("enable-prebid-ads")?asc.cmd.push(asc.processAdsOnPage):window.googletag.cmd.push(function(){var e=window.googletag.defineSlot(i.name,i.ad_sizes.map(function(e){return[e.ad_width,e.ad_height]}),i.ad_div).addService(window.googletag.pubads());t.adSlots.push(e),window.googletag.pubads().refresh([e]),window.googletag.display(i.ad_div)}),e.once("adPageChange",function(){t.fire("subviewViewEvent","adPageTimeoutStart")})),this},showUpsell:function(){var e=this.get("container"),t=e.one("#interstitial-photo-upsell"),i=e.one("iframe");t&&t.addClass("show-upsell"),i&&i.setStyle("display","none")},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"}).show()},getPhotoForDisplay:function(e){var t,i,o,n=this.getCanvasSize(),s=this.getPixelRatio();return e&&e.canvasSize&&(n=e.canvasSize),t=this.get("photo").getSizeToFit(n,e),i=Math.min(n.height/s,t.height),o=Math.min(n.width/s,t.width/t.height*i),i=Math.min(i,t.height/t.width*o),{width:Math.round(o),height:Math.round(i),url:t.url,pixelRatio:t.width/o}},getCanvasSize:function(){var e,t,i,o,n,s,a=this.getPixelRatio(),r=this.get("container"),h={width:500,height:500};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(t=this.get("container").ancestor(),i=r.getStyle("paddingTop")?parseInt(r.getStyle("paddingTop").match(/[0-9]+/)[0],10):0,o=r.getStyle("paddingBottom")?parseInt(r.getStyle("paddingBottom").match(/[0-9]+/)[0],10):0,s=40,n=40,t&&((e=t.get("region")).height=parseInt(t.getStyle("height").match(/[0-9]+/)[0],10)-(i+o),e.width=this.appContext.viewportData.viewport.width-(s+n))):e=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(h={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),e||(e={top:0,left:0,bottom:500,right:500,width:h.width,height:h.height}),e.height*=a,e.width*=a,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()},destructor:function(){var e=this;this.isAd&&(this.appContext.flipper.isFlipped("enable-prebid-ads")||window.googletag.cmd.push(function(){window.googletag.destroySlots(e.adSlots)}))}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","moment","vr-overlay-view","zoom-view","hermes-template-photo-well-media-scrappy","hermes-template-sub-photo-moola-view","hermes-template-photo-well-media-interstitial-moola"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});