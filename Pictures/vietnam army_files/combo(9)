YUI.add("flickr-favorites-remove-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-favorites-remove"]={run:function(o,i){var t={};return t.photo_id=o.photoId,t.user_id=o.userId,i.callAPI("flickr.favorites.remove",t).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("photo-model-helper",function(e,t){var i=require("hermes-core/flog")(t);e.PhotoModelHelper={updateEngagement:function(t,i){var r,n=[];return e.Lang.isObject(i,!0)&&"isFaved"in i&&(r=i.isFaved.newVal?"flickr-favorites-add":"flickr-favorites-remove",n.push(e.ModelUpdaters[r].run({photoId:t},this.appContext))),e.Promise.all(n)},toggleFave:function(e){var t=this.getValue(e,"faveCount"),i=!this.getValue(e,"isFaved"),r=t+(i?1:-1);this.setValues(e,{isFaved:i,faveCount:r}),"photo-engagement-models"!==this.name&&this.appContext.getModelRegistry("photo-engagement-models").then(function(t){t.exists(e)&&t.toggleFave(e)})},addAsFave:function(e){var t=this.getValue(e,"faveCount"),i=this.getValue(e,"isFaved");return i||this.setValues(e,{isFaved:!0,faveCount:t+1}),"photo-engagement-models"!==this.name&&this.appContext.getModelRegistry("photo-engagement-models").then(function(t){t.exists(e)&&t.toggleFave(e)}),!i},getLargestSize:function(e,t){return this.getSizeToFit(e,{width:Number.MAX_VALUE,height:Number.MAX_VALUE},t)},getSizeToFit:function(t,r,n){n=n||{};var a,o,s,u,d=this,l=r.width,h=r.height,c=!!n.cropToFit,g=n.includeSquare,f=n.sizes||this.getValue(t,"sizes"),v=n.excludeSizes||["o"],p=n.includeSizes;if(void 0===n.includeSizes)try{p=Object.keys(f)}catch(e){i.warn("getSizeToFit with invalid sizes",{err:e,sizes:f})}return this._getSizeToFitMemo=this._getSizeToFitMemo||{},a=[t,l,h,c,v.sort().join(""),p.sort().join("")].join("_"),this._getSizeToFitMemo[a]||(e.Object.each(f,function(e,i){var r,n,a,d,f;e&&-1===v.indexOf(i)&&p.indexOf(i)>-1&&(g||!this.isSizeSquare(i)||this.isPhotoSquare(t))&&(r=parseInt(e.width,10),n=parseInt(e.height,10),c&&r>=l&&n>=h?a=!0:!c&&(r>=l||n>=h)&&(a=!0),a&&(o?n<parseInt(o.height,10)&&(o=e):o=e),s?(d=parseInt(s.width,10),f=parseInt(s.height,10),(r>d||n>f)&&(s=e)):s=e),u=o||s},this),this._getSizeToFitMemo[a]=u,this._getSizeToFitMemoTimer||(this._getSizeToFitMemoTimer=setTimeout(function(){delete d._getSizeToFitMemo,delete d._getSizeToFitMemoTimer},1e4))),e.clone(this._getSizeToFitMemo[a],!0)},getSizeIfExact:function(e,t){var i,r,n=this.getValue(e,"sizes");return Object.keys(n).some(function(e){return"o"!==e&&(r=n[e],t.height===r.height&&t.width===r.width&&(i=r,!0))}),i},isSizeSquare:function(e){return["sq","q"].indexOf(e)>-1},isPhotoSquare:function(t){var i;return this._isPhotoSquareMemo=this._isPhotoSquareMemo||{},void 0!==this._isPhotoSquareMemo[t]?i=this._isPhotoSquareMemo[t]:(i=!0,e.Object.some(this.getValue(t,"sizes"),function(e,t){if(e&&e.width&&e.height&&!this.isSizeSquare(t)&&1!=parseInt(e.width,10)/parseInt(e.height,10))return i=!1,!0},this),this._isPhotoSquareMemo[t]=i),i},getSizeForCanvas:function(e,t,i,r){r=r||1;var n,a,o=this.getSizeToFit(e,{width:t*r,height:i*r});return n=Math.min(i/r,o.height),a=Math.min(t/r,o.width/o.height*n),n=Math.min(n,o.height/o.width*a),{width:Math.round(a),height:Math.round(n),url:o.url,pixelRatio:o.width/a}},attributes:{title:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},mediaType:{validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"photo"},license:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){return"video"===this.getValue(t,"mediaType")}},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var i=this.getValue(t,"owner"),r=this.appContext.getViewer();return!!r.signedIn&&i.getValue("id")===r.nsid}},sizes:{},descendingSizes:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(e){var t,i,r=[];if(this._descendingSizesMemo=this._descendingSizesMemo||{},this._descendingSizesMemo[e])return this._descendingSizesMemo[e];t=this.getValue(e,"sizes");for(i in t)r.push(t[i]),r[r.length-1].key=i;return r.sort(function(e,t){return e.width<t.width?1:e.width===t.width?e.height<t.height?1:e.height===t.height?"o"===e.key?-1:1:-1:-1}),this._descendingSizesMemo[e]=r,r}},ascendingSizes:{readOnly:!0,derivedBy:["descendingSizes"],defaultFn:function(e){return this.getValue(e,"descendingSizes").reverse()}},aspectRatio:{readOnly:!0,derivedBy:["descendingSizes","rotation"],defaultFn:function(e){var t=this.getValue(e,"descendingSizes")[0];return"o"===t.key&&this.getValue(e,"rotation")%180!=0?t.height/t.width:t.width/t.height}},needsInterstitial:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},canPublicComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/"+e:void 0}},rotation:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},ownerNsid:{},isFaved:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},faveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},canFave:{readOnly:!0,derivedBy:["is_owner"],getter:function(e,t){return!this.getValue(t,"isOwner")}},canPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},basicSimilaritySearchURL:{readOnly:!0,getter:function(e,t){return"/search/?similarity_id="+t}},similaritySearchURL:{readOnly:!0,derivedBy:["basicSimilaritySearchURL"],getter:function(e,t){var i=this.getValue(t,"basicSimilaritySearchURL");return this.appContext.flipper.isFlipped("enable-similarity-search-safety")&&(i+="&safe_search=1"),i}}}}},"@VERSION@",{requires:["flickr-favorites-add-updater","flickr-favorites-remove-updater"]});YUI.add("flickr-photos-geo-setLocation-updater",function(o,t){"use strict";o.namespace("ModelUpdaters")["flickr-photos-geo-setLocation"]={run:function(e,r){return r.callAPI("flickr.photos.geo.setLocation",e).then(null,o.FetcherErrorLogger(t))}}},"@VERSION@");YUI.add("photo-geo-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-photos-getInfo"].run(e,this.appContext).then(function(t){return t},function(){})},update:function(e,r){var i={photo_id:e,lat:this.getValue(e,"latitude"),lon:this.getValue(e,"longitude")};return r.hasOwnProperty("accuracy")&&(i.accuracy=this.getValue(e,"accuracy")),(r.hasOwnProperty("isPublic")||r.hasOwnProperty("isContact")||r.hasOwnProperty("isFriend")||r.hasOwnProperty("isFamily"))&&(i.is_public=Number(this.getValue(e,"isPublic")),i.is_contact=Number(this.getValue(e,"isContact")),i.is_friend=Number(this.getValue(e,"isFriend")),i.is_family=Number(this.getValue(e,"isFamily"))),t.ModelUpdaters["flickr-photos-geo-setLocation"].run(i,this.appContext)}},attributes:{hasGeo:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},latitude:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultValue:void 0},longitude:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultValue:void 0},accuracy:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(Math.max(1,Math.min(e,16)))||void 0},defaultValue:1},isPublic:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isContact:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isFriend:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},isFamily:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getInfo-fetcher","attribute-helpers","flickr-photos-geo-setLocation-updater"]});YUI.add("photo-location-models",function(e){function t(e){t.superclass.constructor.call(this,e)}t.SUPPORTED_WOE_LEVELS=["neighbourhood","locality","county","region","country","continent"],e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext).then(function(e){return e},function(){})}},attributes:{geo:{isModel:!0},hasGeo:{readOnly:!0,derivedBy:["geo"],defaultFn:function(e){var t=this.getValue(e,"geo");return!!t&&t.getValue("hasGeo")}},latitude:{readOnly:!0,derivedBy:["geo"],defaultFn:function(e){var t=this.getValue(e,"geo");return t?t.getValue("latitude"):null}},longitude:{readOnly:!0,derivedBy:["geo"],defaultFn:function(e){var t=this.getValue(e,"geo");return t?t.getValue("longitude"):null}},levels:{},text:{},mostSpecificWoeId:{readOnly:!0,derivedBy:["levels"],defaultFn:function(e){var n,o=this.getValue(e,"levels");return t.SUPPORTED_WOE_LEVELS.some(function(e){if(o[e]&&o[e].woeId)return n=o[e].woeId,!0}),n}},mostSpecificLevelIndex:{readOnly:!0,derivedBy:["levels"],defaultFn:function(e){var n,o=this.getValue(e,"levels");return t.SUPPORTED_WOE_LEVELS.some(function(e,t){if(o[e]&&o[e].woeId)return n=t,!0}),n}},staticMaps:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","attribute-helpers"]});YUI.add("flickr-photos-getLocation-fetcher",function(e,o){"use strict";e.namespace("ModelFetchers")["flickr-photos-getLocation"]={run:function(t,n){var i={photo_id:t.id,extras:"venue"},s=this;return e.APIHelper.request.addStaticMapsParams(i),e.Promise.all([n.callAPI("flickr.photos.geo.getLocation",i),n.getModelRegistry("photo-location-models"),n.getModelRegistry("photo-geo-models")]).then(function(e){var o=e[0],t=e[1],n=e[2],i=s.mapResponse(o,n);return t.addOrUpdate(i),i},e.FetcherErrorLogger(o))},mapResponse:function(o,t){var n,i,s=o.photo||{},a=s.location||null,r=s.staticMaps&&s.staticMaps.staticMap||null,l=s.venues?s.venues.venue:null,c=[];return i={id:s.id,levels:{}},a?(n={id:s.id,hasGeo:!0,latitude:a.latitude,longitude:a.longitude,accuracy:a.accuracy},e.Models["photo-location-models"].SUPPORTED_WOE_LEVELS.forEach(function(e){a[e]&&(i.levels[e]={name:a[e].content||null,woeId:a[e].woeid||null})}),s.geoperms&&(n.isPublic=s.geoperms.ispublic,n.isContact=s.geoperms.iscontact,n.isFriend=s.geoperms.isfriend,n.isFamily=s.geoperms.isfamily)):n={id:s.id,hasGeo:!1},i.geo=t.addOrUpdate(n),l&&(i.levels.venue={name:l.content||l.address||null,woeId:l.woe_id,source:l.source,venueId:l.id,venueLat:l.latitude,venueLong:l.longitude},l.content&&c.push(l.content),l.city&&c.push(l.city),l.country&&c.push(l.country),i.text=c.join(", ")),i.text||(i.text=(function(e){var o,t,n,i=[];for(o=[["venue","locality","region"],["neighbourhood","locality","region"],["locality","region","country"],["county","region","country"]];o.length&&i.length<3;)for(t=o.shift(),i=[];t.length&&i.length<3;)n=t.shift(),e[n]&&e[n].name&&i.push(e[n].name);return i.join(", ")})(i.levels)),e.Lang.isArray(r)&&(i.staticMaps={},r.forEach(function(e){i.staticMaps["zoom"+e.zoom]=e})),i}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-geo-models","photo-location-models"]});YUI.add("photo-engagement-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:e.PhotoModelHelper.updateEngagement,delete:function(t){return e.ModelUpdaters["flickr-favorites-remove"].run(t,this.appContext)}},toggleFave:e.PhotoModelHelper.toggleFave,addAsFave:e.PhotoModelHelper.addAsFave,attributes:{ownerNsid:e.PhotoModelHelper.attributes.ownerNsid,isFaved:e.PhotoModelHelper.attributes.isFaved,faveCount:e.PhotoModelHelper.attributes.faveCount,commentCount:e.PhotoModelHelper.attributes.commentCount,canFave:e.PhotoModelHelper.attributes.canFave,canPrint:e.PhotoModelHelper.attributes.canPrint,canShare:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},noteCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var r=this.appContext.getViewer();return!!r.signedIn&&this.getValue(t,"ownerNsid")===r.nsid}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-favorites-add-updater","flickr-favorites-remove-updater","attribute-helpers"]});YUI.add("flickr-photos-setDates-updater",function(t,e){"use strict";var a=require("hermes-core/flog")(e);t.namespace("ModelUpdaters")["flickr-photos-setDates"]={run:function(o,r){var d={};return o.fullResponse?(d.photo_ids=o.photoId,d.full_response=1):d.photo_id=o.photoId,o.dateTakenPartial&&(d.partial_date_taken=o.dateTakenPartial),o.datePostedPartial&&(d.partial_date_posted=o.datePostedPartial),o.datePosted&&(d.date_posted=o.datePosted),o.dateTaken&&(d.date_taken=o.dateTaken),o.takenGranularity>=0&&o.takenGranularity<=10&&(d.date_taken_granularity=o.takenGranularity),t.Promise.all([r.callAPI("flickr.photos.setDates",d),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photostream-models")]).then(function(t){var e,d=t[0],n=t[1],s=t[2],l={};if(s.attributeSearch({normalizedId:r.getViewer().nsid},!0).forEach(function(t){s.remove(t)}),e=d.errors,o.fullResponse){if(e&&d.errors.length>0)return e}else{if(!n.exists(o.photoId))throw new Error("[flickr-photos-setDates-updater] - Photo-stats model can not be updated if it does not exist");d.photo&&(d.photo.datePosted||d.photo.dateTaken)||a.warn("No updated data returned from API."),d.photo?(d.photo.datePosted&&(l.datePosted=d.photo.datePosted.content),d.photo.dateTaken&&(l.dateTaken=d.photo.dateTaken.content,l.takenGranularity=d.photo.dateTakenGranularity.content)):(o.datePosted&&(l.datePosted=o.datePosted),o.dateTaken&&(l.dateTaken=o.dateTaken),o.takenGranularity&&(l.takenGranularity=o.takenGranularity)),Object.keys(l).length>0&&n.setValues(o.photoId,l)}},function(t){throw o.fullResponse&&(t.photoIds=o.photoId),t}).then(null,t.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});