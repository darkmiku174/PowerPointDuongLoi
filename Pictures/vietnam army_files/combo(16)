YUI.add("flickr-people-getPhotos-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-people-getPhotos"]={run:function(t,s){var r=this,p=[s.callAPI("flickr.people.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("photo-privacy-models")];return t.createCompoundID&&s.getViewer().signedIn&&s.getViewer().nsid&&p.push(s.getModel("person-preferences-models",s.getViewer().nsid)),e.Promise.all(p).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o){var t={per_page:o.perPage||20,page:o.page||1,extras:e.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:o.withPhotoId||""};return o.id||o.userId?t.user_id=(o.id||o.userId).split("-")[0]:o.pathAlias&&(t.path_alias=o.pathAlias),o.privacyFilter&&(t.privacy_filter=o.privacyFilter),o.viewAs&&(t.view_as=o.viewAs),o.orderBy&&("datetaken"===o.orderBy?t.sort="date-taken-desc":t.sort=o.orderBy),o.safeSearch&&(t.safe_search=o.safeSearch),o.media&&(t.media=o.media),o.withPhotoId&&(t.jump_to=o.withPhotoId),o.contentType&&(t.content_type=o.contentType),t},_processResponse:function(o,t){var s,r,p=o[0],a=o[1],i=o[2],d=o[3],n=o[4],l=o[5],h=o[6],g=p&&p.user?p.user.nsid:null,c=t.id||t.userId;if(!g)throw new Error("API was missing valid nsid");return r={id:g,pathAlias:p.user.pathAlias,owner:e.APIHelper.response.parsePerson(p.user),totalItems:p.photos.total},c&&c!==g&&(r.id=c),o[7]&&(r.id=g+"-"+e.Models["person-preferences-models"].buildContextSuffix(o[7],g)),r.owner=i.addOrUpdate(r.owner),s=e.APIHelper.response.parsePhotos({photos:p.photos.photo,ownerID:p.photos.owner,personModelRegistry:i,photoModelRegistry:a,photoEngagementModelRegistry:n,photoStatsModelRegistry:l,photoPrivacyModelRegistry:h}),r.photoPageList={perPage:p.photos.perpage,page:p.photos.page,pageContent:s,totalItems:parseInt(p.photos.total,10)||0},d.addOrUpdate(r),s}}},"@VERSION@",{requires:["flickr-promise","api-helper","person-preferences-models"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]});YUI.add("photostream-models",function(e,t){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t,r=this.appContext.getViewer(),n=this.getValue(e,"normalizedId");return r&&r.nsid===n?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(t=this.getValue(e,"owner"))?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:t.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"})}},pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),r=this.getValue(e,"normalizedId");return"/photos/"+(t?t.getValue("pathAlias"):r)+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,n=r.splitCompoundId(e);return n.orderBy?(t=n.orderBy,n.viewAs?t+="-"+n.viewAs:"dateposted"===n.orderBy&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,r){var n=e;return t&&(n+="-"+t),r&&(t||(n+="-dateposted"),n+="-"+r),n},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]});YUI.add("person-model-helper",function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},username:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/photos/"+this.getValue(e,"pathAlias")+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proBadge:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},canBuyPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var r=this.getValue(t,"isPro"),n=this.getValue(t,"isAdFree");return r||n}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},expiringPartner:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},uploadCount:{defaultValue:null},uploadLimit:{defaultValue:null},uploadLimitStatus:{defaultValue:null},isCognitoUser:{defaultValue:null},hasAuthorizedMobile:{defaultValue:null},hasInvalidEmail:{defaultValue:!1},subscription:{defaultValue:{isPastDue:!1,isPro:!1,isClosed:!1}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper"]});YUI.add("flickr-people-getInfo-fetcher",function(e,r){"use strict";var s=new e.SubscriptionsHelper;e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:function(s,o){var t=this,i=o.getViewer();return i&&i.signedIn&&(s.id===i.nsid||s.nsid===i.nsid)&&(s.storage=1),new e.FlickrPromise({apiResponse:o.callAPI("flickr.people.getInfo",this._processParams(s,o),!0),personModelRegistry:o.getModelRegistry("person-models"),personRelationshipModelRegistry:o.getModelRegistry("person-relationship-models"),personProfileModelRegistry:o.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:o.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:o.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:o.getModelRegistry("person-notifications-models"),photostreamModelRegistry:o.getModelRegistry("photostream-models")}).then(function(e){return t._processResponse(e,s,o)},e.FetcherErrorLogger(r))},_processParams:function(r,s){var o={datecreate:1};if(o.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&r.id===s.request.probableUser?(o.storage=1,o.extras+=", classic_user_id, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref, products_features, subscriptions",o.extras+=", is_minor"):s.getViewer().signedIn&&r.id===s.getViewer().nsid&&(o.extras+=", products_features, subscriptions"),r.extras&&"string"==typeof r.extras&&r.extras.length>0&&(o.extras=o.extras+","+r.extras),r.id)o.user_id=r.id;else{if(!r.pathAlias)throw new Error("`fetch` is missing required params.");o.path_alias=r.pathAlias}return r.storage&&(o.storage=r.storage),o.extras||(o.extras=""),o.extras+=", has_stats",o},_processResponse:function(r,o,t){var i,a,n,p=r.apiResponse,d=r.personModelRegistry,l=r.personRelationshipModelRegistry,u=r.personProfileModelRegistry,c=r.personPreferencesModelRegistry,g=r.personGroupsModelRegistry,m=r.personNotificationsModelRegistry,h=r.photostreamModelRegistry,f=p.person,y=t.getViewer(),M=f.id,_=y&&y.signedIn&&M===y.nsid;return n={id:M,pathAlias:f.pathAlias,username:f.username&&f.username._content,realname:f.realname&&f.realname._content,buddyicon:e.APIHelper.response.removeProtocolFromURL(f.iconurls),isAdFree:f.isAdFree,isPro:f.ispro,proBadge:f.proBadge,isMinor:f.isMinor,canBuyPro:f.canBuyPro,hasStats:f.hasStats,location:f.location&&f.location._content,hasAdfree:f.hasAdfree,has1TB:f.has1TB,has2TB:f.has2TB,hasUnlimitedStorage:f.hasUnlimitedStorage,hasFreeStandardShipping:f.hasFreeStandardShipping,hasFreeEducationalResources:f.hasFreeEducationalResources,dateCreated:f.datecreate._content,expiringPartner:f.expiringPartner},f.ispro&&(n.proExpireDate=f.expire),_&&(n.uploadLimit=f.uploadLimit,n.uploadCount=f.uploadCount,n.uploadLimitStatus=f.uploadLimitStatus,n.isCognitoUser=f.isCognitoUser,n.hasInvalidEmail=!1,f.email&&(!f.email||f.email._content&&""!==f.email._content)?f.email._content&&-1===f.email._content.indexOf("@")?n.hasInvalidEmail=!0:n.hasInvalidEmail=!1:n.hasInvalidEmail=!0,n.isPro&&(n.subscription=s.parseEffectiveSubscriptionData(!0,p.effectiveSubscriptions,t.flipper.isFlipped("enable-opt-in-migration")))),d.addOrUpdate(n),m.addOrUpdate({id:M,unreadFlickrMailCount:f.unreadMessages?f.unreadMessages.content:0}),l.addOrUpdate({id:M,pathAlias:f.pathAlias,isContact:f.contact,isFriend:f.friend,isFamily:f.family,isIgnored:f.ignored,isIgnoredBy:f.ignoredby,isRevContact:f.revcontact,isRevFriend:f.revfriend,isRevFamily:f.revfamily}),_&&(a={id:M},f.safeSearch&&(a.safeSearch=(f.safeSearch||1)-1),f.viewPrefs&&(a.unifiedSearchViewPref=f.viewPrefs.unifiedSearchViewPref,a.photostreamViewOrderPref=f.viewPrefs.photostreamViewOrderPref,a.photostreamViewAsPref=f.viewPrefs.photostreamViewAsPref,a.albumViewLayoutPref=f.viewPrefs.albumViewLayout,a.galleryViewLayoutPref=f.viewPrefs.galleriesViewLayoutPref),c.exists(M)?c.setValues(M,a):c.add(a)),i={id:M,coverPhotoUrls:e.APIHelper.response.removeProtocolFromURL(f.coverphoto_url),photoCount:f.photos.count.content,location:f.location?f.location.content:null,arrPhotoCount:f.all_rights_reserved_photos_count},f.storage&&(i.storageUsed=f.storage.used.content,i.storageTotal=f.storage.total.content),f.unreadMessages&&(i.unreadMessages=f.unreadMessages.content),u.addOrUpdate(i),g.addOrUpdate({id:M,memberCount:f.groupMemberships?f.groupMemberships.member:null,moderatorCount:f.groupMemberships?f.groupMemberships.moderator:null,adminCount:f.groupMemberships?f.groupMemberships.admin:null,invitedCount:f.groupMemberships?f.groupMemberships.invited:null}),h.addOrUpdate({id:M,pathAlias:f.pathAlias,owner:d.proxy(M),totalItems:f.photos.count&&f.photos.count.content}),f}}},"@VERSION@",{requires:["flickr-promise","subscriptions-helper"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","photostream-models","api-helper"]});YUI.add("person-relationship-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,i){var r=[],n={};return e.Lang.isObject(i,!0)&&(n.user_id=t,n.friend=this.getValue(t,"isFriend"),n.family=this.getValue(t,"isFamily"),"isContact"in i&&(i.isContact.newVal?r.push(e.ModelUpdaters["flickr-contacts-add"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-remove"].run(n,this.appContext))),("isFriend"in i||"isFamily"in i)&&("isFriend"in i&&(n.friend=i.isFriend.newVal),"isFamily"in i&&(n.family=i.isFamily.newVal),r.push(e.ModelUpdaters["flickr-contacts-edit"].run(n,this.appContext))),"isIgnored"in i&&(!0===i.isIgnored.newVal?r.push(e.ModelUpdaters["flickr-contacts-block"].run(n,this.appContext)):r.push(e.ModelUpdaters["flickr-contacts-unblock"].run(n,this.appContext)))),e.Promise.all(r)}},toggleFollowing:function(e){this.getValue(e,"isContact")?this.setValue(e,"isContact",!1):this.setValue(e,"isContact",!0)},toggleFriend:function(e){this.getValue(e,"isFriend")?this.setValue(e,"isFriend",!1):this.setValue(e,"isFriend",!0)},toggleFamily:function(e){this.getValue(e,"isFamily")?this.setValue(e,"isFamily",!1):this.setValue(e,"isFamily",!0)},toggleIgnore:function(e){this.getValue(e,"isIgnored")?this.setValue(e,"isIgnored",!1):this.setValue(e,"isIgnored",!0)},attributes:{pathAlias:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevContact:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFriend:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isRevFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnoredBy:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isIgnored:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isMe:{readOnly:!0,getter:function(e,t){var i=this.appContext.getViewer();return!!i&&this.getValue(t,"nsid")===i.nsid}},nsid:{readOnly:!0,defaultFn:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-contacts-add-updater","flickr-contacts-remove-updater","flickr-contacts-edit-updater","flickr-contacts-block-updater","flickr-contacts-unblock-updater","attribute-helpers"]});YUI.add("banner-helper",function(e,n){require("hermes-core/flog")(n),e.mix({langBundles:["featured-banner"]},e.Localizable);var r=new e.SubscriptionsHelper;e.BannerHelper=function(n){function i(){a=o.sort(function(e,n){return e.priority-n.priority})}var t=this,o=[],a=[],u="products-pro-view",s={loginMigration:function(r){return{priority:"priority"in r?r.priority:Number.MAX_VALUE,placement:"placement"in r?r.placement:"header",load:function(){return e.Promise.resolve()},canShowBanner:function(){var e=!1,r=n.getViewer().isCognitoUser;return!n.getViewer().signedIn||r||(function(){var e=[u],r=n.flapp.get("activeView").name;return!!(r&&e.indexOf(r)>-1)})()||(e=!0),e},viewName:"login-migration-banner-view",viewConfig:{}}},pastDue:function(r){var i;return{priority:"priority"in r?r.priority:Number.MAX_VALUE,placement:"placement"in r?r.placement:"header",load:function(){var r=n.getViewer();return r.signedIn&&r.isPro?n.getModel("person-models",r.nsid).then(function(e){var n=e.getValue("subscription");i=n.isPastDue}):(i=!1,e.Promise.resolve())},canShowBanner:function(){var e=!1;return n.getViewer().signedIn&&n.getViewer().isPro&&i&&(e=!0),e},viewName:"past-due-banner-view",viewConfig:{}}},braintreeMigrate:function(i){var t=!1,o=!0;return{priority:"priority"in i?i.priority:Number.MAX_VALUE,placement:"placement"in i?i.placement:"header",load:function(){var i=n.getViewer();return i.signedIn&&i.isPro?n.getModel("subscription-history-list-models",i.nsid).then(function(n){var i=r.isUserCurrentlyOnABraintreeSub(n);t=i.isUserCurrentlyOnABraintreeSub,o=i.renewalDate&&i.renewalDate.isBefore(e.moment().add(15,"days"))}.bind(this)):(t=!1,e.Promise.resolve())},canShowBanner:function(){var r=!1;return n.getViewer().signedIn&&n.flipper.isFlipped("enable-braintree-migration-banner")&&n.getViewer().isPro&&t&&(!n.getCookie(e.config.flickr.banners.dismiss_braintree_migration_banner_name)||n.getCookie(e.config.flickr.banners.dismiss_braintree_migration_banner_name)&&o)&&(r=!0),r},viewName:"braintree-migrate-banner-view",viewConfig:{}}},cookie:function(r){return{priority:"priority"in r?r.priority:Number.MAX_VALUE,placement:"placement"in r?r.placement:"header",load:function(){return e.Promise.resolve()},canShowBanner:function(){return!n.getCookie(e.config.flickr.banners.dismiss_cookie_banner_name)&&e.config.flickr.geo.eu},viewName:"cookie-banner-view",viewConfig:{}}}};return this.loadBanners=function(n){var r=n.map(function(n){return(function(n){var r=new s[n.type]({priority:n.priority,placement:n.placement});return r?r.load().then(function(){!(function(e){o.push(e),i()})(r)}):e.Promise.resolve()})(n)});return e.Promise.all(r)},this.getBanners=function(e){var n=[];return e.forEach(function(e){var r=(function(e){var r,t=a.find(function(n,i){if((void 0===e||n.placement===e)&&n.canShowBanner())return r=i,!0});if(t)return(function(e){n.splice(e,1),i()})(r),t})(e);r&&n.push(r)}),n},this.getQueue=function(){return a},this.typeObjects=s,this.renderBannerView=function(e){return(function(e){return n.getView(e.viewName,{appContext:n}).then(function(e){var r;return n.getView("banner-view",{appContext:n,subview:e}).then(function(e){return(r=e).initialize()}).then(function(){return r})})})(e).then(function(n){t.fire("renderBanner",{placement:e.placement,bannerView:n})})},this},e.augment(e.BannerHelper,e.EventTarget)},"@VERSION@",{requires:["banner-view","event-custom","subscription-history-list-models","person-models"]});YUI.add("app-context",function(e,i){var t,n=require("hermes-core/flog")(i),o=require("hermes-core/fletrics"),r=YUI.Env.isServer?e.config.flickr.api.server_default_timeout:e.config.flickr.api.client_default_timeout,s=YUI.Env.isServer?e.config.flickr.api.server_retry_timeout:e.config.flickr.api.client_retry_timeout,a=[117,118,119],l=new RegExp(e.config.flickr.api.write_api_method_regex),c=e.config.flickr.model_eviction,h={};(t=e.AppContext=function(i){(i=i||{}).request&&(this.request=i.request),this.params={},this._initializeParams(i),this.viewTiming={},this.modelRegistries={},this.modelImportExport=new e.ModelImportExport(this),this.flickrAPI=new e.FlickrAPI(this.request,this),this.auth=i.auth,this.flapp=i.flapp,this.writeAPICallsMadeOnThisPage={},this._moduleInstances={},this._pendingYUIPromises={},this._loadedViews={},this._apiCalls={},this._previousLocation=null,this._uploadInProgress=!1,this._pendingUploadErrorModal=null,this._concurrentAPICalls=0,this._apiQueueOrder=[],this._apiQueueFunctions={},this._preliminaryNsid=null,this.flipper=new e.Flipper(i.flipper),this.experiments={fullscreen:new e.Experiments.Fullscreen(this),optOut:new e.Experiments.OptOut(this)},this.secure="https"===this.protocol,this.adManager=new e.AdManager(this.params.referrer,this),this.viewportData=new e.ViewportData(this),this.clientId="f"+Math.round(1e4*Math.random()).toString(36),this.isCSSLoaded=!1,this.bannerManager=new e.BannerHelper(this),this.initGlobalEvictionExemptionConfig()}).getValidParams=function(){return["bucket","protocol","buckets","slice","random_slice","referrer","flipper","lang","gp_code","gp_owner","share_code"]},t.prototype={routeConfig:{},_initializeParams:function(e){var i=this;t.getValidParams().forEach(function(t){e.request&&t in e.request&&(e[t]=e.request[t]),t in e&&(i[t]=e[t],i.params[t]=e[t])})},promisedUse:function(i){var t=YUI.Env.isServer,n=t?this.request.app.yui:e;return new e.Promise(function(e,o){n.use(i,function(i,n){t?e(i):n&&"success"in n?n.success?e(i):o(n.msg):o("Y.use: no status provided")})})},instantiateYUIModule:function(i,t){if(!e.Lang.isString(i)||!e.Lang.isFunction(t))return e.Promise.reject("[app-context] `instantiateYUIModule` called without a `name` or `initializer`.");var n=this._moduleInstances,o=this._pendingYUIPromises;return o[i]||(n[i]?o[i]=e.Promise.resolve(n[i]):o[i]=this.promisedUse(i).then(function(){var e=t();return n[i]=e,delete o[i],e})),o[i]},getModelRegistry:function(i){if(!e.Lang.isString(i))return e.Promise.reject("[app-context] `getModelRegistry` called without a `name`.");var t,r=this;return this.instantiateYUIModule(i,function(s){if(!e.Models||!e.Models[i]||"function"!=typeof e.Models[i])throw n.error("There was an error loading the modelregistry",{status:s}),o.increment("appContext.getmodelregistry.failures"),t=new Error("[app-context] - Model registry failed to load:"+i),t.moduleLoadingError=!0,t;var a=new e.Models[i](r);return r.modelRegistries[i]=a,a})},getModel:function(i,t,n){return e.Lang.isString(i)&&t?this.getModelRegistry(i).then(function(i){return this._refetchExistingModels&&(e.Lang.isObject(t,!0)?i.attributeSearch(t):[t]).forEach(function(e){this.canEvictModel(i,e)&&this.evictModel(i,e)}.bind(this)),i.get(t,n)}.bind(this)):e.Promise.reject("[app-context] `getModelRegistry` called without a `registryName` or `modelId`.")},markAsNewlyFetched:function(e,i){this._refetchExistingModels&&(this._refetchedModels[e]||(this._refetchedModels[e]={}),this._refetchedModels[e][i]=!0)},getRoute:function(i){var t,r=this;return this.instantiateYUIModule(i,function(s){if(!e.Routes||!e.Routes[i]||"function"!=typeof e.Routes[i])throw n.error("There was an error loading the route",{status:s}),o.increment("appContext.getroute.failures"),t=new Error("[app-context] - Route failed to load:"+i),t.moduleLoadingError=!0,t;return new e.Routes[i](r)})},getView:function(i,t,r){var s,a=this;return t=t||{},t.appContext=a,a.promisedUse(i).then(function(r){if(!e.Views||!e.Views[i]||"function"!=typeof e.Views[i])throw n.error("There was an error loading the view",{status:r}),o.increment("appContext.getview.failures"),s=new Error("[app-context] - View failed to load:"+i),s.moduleLoadingError=!0,s;return a._loadedViews[i]=!0,new e.Views[i](t)})},getLoadedViews:function(){return Object.keys(this._loadedViews)},setGPCredentials:function(e){null===e?(delete this.params.gp_owner,delete this.params.gp_code,delete this.params.share_code,delete h.gp_owner,delete h.gp_code,delete h.share_code,n.info("Setting GP credentials to null")):null!==e&&e.gp_code&&(this.params.gp_owner=e.gp_owner,this.params.gp_code=e.gp_code,this.params.share_code=e.share_code,h.gp_owner=e.gp_owner,h.gp_code=e.gp_code,h.share_code=e.share_code,n.info("Setting GP credentials to "+e.share_code))},getCookie:function(i){return YUI.Env.isServer?this.request.cookies[escape(i)]:e.Cookie.get(i)},setCookie:function(i){if(YUI.Env.isServer)n.warn("You can't set a cookie from the server with AppContext -- use middleware.",i);else{i.cookieName&&void 0!==i.cookieValue&&i.path||n.error("Missing important parameters to set a cookie");var t=i.cookieName,o=i.cookieValue,r=i.domain||".flickr.com",s=i.path,a=i.expiresMonthsFromNow||3,l=i.expires?i.expires:e.moment().add(a,"months").toDate();i.remove&&e.Cookie.remove(t,{domain:i.domain||".flickr.com",path:s}),e.Cookie.set(t,o,{domain:r,path:s,expires:l})}},removeCookie:function(i){YUI.Env.isServer?n.warn("You can't remove a cookie from the server with AppContext -- use middleware.",i):(i.cookieName&&i.path||n.error("Missing important parameters to remove a cookie"),e.Cookie.remove(i.cookieName,{domain:i.domain||".flickr.com",path:i.path}))},getViewer:function(){var e={},i=this;return e.getPixelRatio=function(){var e;return(e=YUI.Env.isServer?i.getCookie("density"):window.devicePixelRatio)||(e=1),e},this.auth&&this.auth.signedIn?(e.nsid=this.auth.user.nsid,e.intl=this.auth.intl,e.signedIn=this.auth.signedIn,e.isInsecureGod=this.auth.isInsecureGod,e.isMinor=this.auth.isMinor,e.isPro=this.auth.user.ispro,e.canReact=this.auth.canReact,e.isCognitoUser=this.auth.isCognitoUser,e.prefs={timezonePref:this.auth.timezonePref,downloadAccessPref:this.auth.downloadAccessPref}):this._preliminaryNsid?(e.nsid=this._preliminaryNsid,e.signedIn=!0):(e.signedIn=!1,e.prefs={timezonePref:{name:"",dst:!1,offset:"+00:00",isDefaults:!0}}),e},setPreliminaryViewerNsid:function(e){this._preliminaryNsid=e},getKeyboardManager:function(){return this._keyboardManager||(this._keyboardManager=new e.KeyboardManager),this._keyboardManager},initGlobalEvictionExemptionConfig:function(){var e=this.getViewer().nsid;this._globalEvictionExemptionConfig={},e&&(this._globalEvictionExemptionConfig["person-preferences-models"]={exemptIds:[e]})},getPreviousURL:function(){var e="";return this._previousLocation&&(e=this._previousLocation.pathname,this._previousLocation.querystring&&(e+="?"+this._previousLocation.querystring),this._previousLocation.hash&&(e+="#"+this._previousLocation.hash)),e},getPreviousLocation:function(){return e.merge(this._previousLocation)},setPreviousLocation:function(){this._previousLocation=this.getLocation()},updateModelRefetchState:function(i,t){if(!this.flipper.isFlipped("evict-models-on-navigate")||!i||t)return this._refetchExistingModels=!1,void(this._refetchedModels=null);var n,o;this._previousLocation&&(n=e.URLHelper.getSiteSectionByURL(this._previousLocation.pathname)),i&&(i="/"+i.split("/").slice(3).join("/"),o=e.URLHelper.getSiteSectionByURL(i)),this._refetchExistingModels=void 0,o&&c.entry_refetch_exemptions[o.name]&&(this._refetchExistingModels=!1),n&&c.exit_refetch_exemptions[n.name]&&(this._refetchExistingModels=!1),void 0===this._refetchExistingModels&&o&&n&&(c.transition_refetch_exemptions[n.name]&&c.transition_refetch_exemptions[n.name][o.name]?this._refetchExistingModels=!1:this._refetchExistingModels=n.name!==o.name),void 0===this._refetchExistingModels&&(this._refetchExistingModels=!1),this._refetchedModels={}},hasClientSideRouted:function(){return!!this._clientSideRouted},setClientSideRouted:function(e){this._clientSideRouted=e},getReferrer:function(){var e;try{e=this.flapp.get("activeView").getViewDataFromHistory("referrer")}catch(e){}return e},getLocation:function(){var i;return YUI.Env.isServer?(i={protocol:this.request.protocol,hostname:this.request.hostname,pathname:this.request.path,query:this.request.query,querystring:this.request.query?e.QueryString.stringify(this.request.query):"",hash:""}).href=i.protocol+"://"+i.hostname+this.request.originalUrl:(i={protocol:e.config.win.location.protocol.split(":")[0],hostname:e.config.win.location.hostname,pathname:e.config.win.location.pathname,querystring:e.config.win.location.search.split("?")[1],href:e.config.win.location.href,hash:e.config.win.location.hash}).query=i.querystring?e.QueryString.parse(i.querystring):"",i},getViewCounter:function(){return this._viewCounter||(this._viewCounter=new e.ViewCounter({appContext:this})),this._viewCounter},getBucket:function(e){if(this.buckets)return this.buckets[e]},handleMismatchedNSID:function(){var i,t;i=e.mix({langBundles:["common"],appContext:this},e.Localizable),(t=new e.Views.FluidModal({title:i.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:i.intlMessage({intlName:"common.OK"}),textMessage:i.intlMessage({intlName:"common.MISMATCHED_NSID_ERROR"}),appContext:this,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",function(i){e.config.win.location.reload(!0)}),t.show()},mitigateClientPanda:function(i){var t,n;return t=e.mix({langBundles:["common"],appContext:this},e.Localizable),(n=new e.Views.FluidModal({title:t.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:t.intlMessage({intlName:"common.OK"}),htmlMessage:t.intlMessage({intlName:i}),appContext:this,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",function(i){e.config.win.location.reload(!0)}),n.show(),e.PromiseChainDestroyer()},callAPI:function(i,t,o,c){var u,d,p,f=this,m=[i,t,null,c];return o=o&&!YUI.Env.isServer,m=null!==h?[i,e.merge(t,h),null,c]:[i,t,null,c],u=i+"__"+Object.keys(t).sort().map(function(e){return encodeURIComponent(e)+"_"+encodeURIComponent(t[e])}).join("__"),this._apiCalls[u]?(e.config.flickr.cameraroll.suppress_logging&&"flickr.cameraroll.getPhotosByOffset"===i||n.log("Reusing API call",{method:i}),f._apiQueueOrder.length>1&&(p=f._apiQueueOrder.indexOf(u))>-1&&p<f._apiQueueOrder.length-1&&(f._apiQueueOrder.splice(p,1),f._apiQueueOrder.push(u)),this._apiCalls[u].then(function(i){return e.clone(i,!0)},function(i){throw e.clone(i,!0)})):(o&&(m.push(null),m.push({timeout:r})),i.match(l)&&this.cacheWriteAPICall(u,i),this._apiCalls[u]=new e.Promise(function(t,r){var l;l=function(){f.flickrAPI.callMethod.apply(f.flickrAPI,m).then(function(e){return f.onAPICallComplete(u,!0),e},function(t){if(f.onAPICallComplete(u,!1),f.flipper.isFlipped("enable-viewer-nsid-check")&&!YUI.Env.isServer&&-1!==a.indexOf(t.code))return f.handleMismatchedNSID(),e.PromiseChainDestroyer();if(!YUI.Env.isServer&&0===t.status&&0===t.total)return f.mitigateClientPanda("common.NETWORK_CONNECTIVITY_ISSUE");if(o&&(t.clientTimeout||0===t.status||t.transportFailure)){if(n.log("Retrying API call",{method:i}),delete f._apiCalls[u],!YUI.Env.isServer&&e.config.win.beaconError){if(e.config.win.document)try{t.domain=e.config.win.document.domain}catch(e){}e.config.win.beaconError("[app-context] Retrying API ",e.config.win.location.href,t)}return(d=m[m.length-1]).timeout&&(d.timeout=s),f._apiCalls[u]=f.flickrAPI.callMethod.apply(f.flickrAPI,m).then(function(t){return f.onAPICallComplete(u,!0),n.log("Successfully retried API call",{method:i}),e.fire("appContext:apiRetry",{apiMethod:i,code:418}),!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("[app-context] Successful API retry ",e.config.win.location.href,{}),t},function(t){throw f.onAPICallComplete(u,!1),n.log("Failed retry of API call",{method:i}),e.fire("appContext:apiRetry",{apiMethod:i,code:408}),!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("[app-context] Failed API retry ",e.config.win.location.href,{}),t}),f._concurrentAPICalls++,f._apiCalls[u]}throw t}).then(t,r)},YUI.Env.isServer?l():(f._apiQueueOrder.push(u),f._apiQueueFunctions[u]=l,f.callNextInQueue())}),this._apiCalls[u])},callNextInQueue:function(){var i,t,n=e.config.flickr.api.max_concurrent_api_calls;this._apiQueueOrder.length&&this._concurrentAPICalls<n&&(this._concurrentAPICalls++,i=this._apiQueueOrder.pop(),t=this._apiQueueFunctions[i],delete this._apiQueueFunctions[i],t())},cacheWriteAPICall:function(e,i){this.writeAPICallsMadeOnThisPage[e]={methodName:i,completed:!1,failed:!1}},onAPICallComplete:function(e,i){var t=this.writeAPICallsMadeOnThisPage[e];t&&(t.completed=!0,t.failed=!i),delete this._apiCalls[e],this._concurrentAPICalls--,this.callNextInQueue()},clearWriteAPICallCache:function(){this.writeAPICallsMadeOnThisPage={}},canEvictModel:function(e,i){var t,n;return!(!e||!i)&&(!!e.exists(i)&&(t=e.name,n=this._globalEvictionExemptionConfig[t],!(n&&n.exemptIds&&-1!==n.exemptIds.indexOf(i))&&(this._refetchedModels[t]||(this._refetchedModels[t]={}),!this._refetchedModels[t][i])))},evictModel:function(e,i){var t=e.name;this.flipper.isFlipped("model-eviction-debugging")&&console.log("[EVICT] "+t+" ["+i+"]"),e.getOwnedModels(i).forEach(function(e){this.canEvictModel(e.registry,e.id)&&this.evictModel(e.registry,e.id)}.bind(this)),e.remove(i)},evictModels:function(i){var t,o,r,s,a=this.getViewer().nsid,l=[],c=this.modelRegistries;for(t in this.writeAPICallsMadeOnThisPage)(o=this.writeAPICallsMadeOnThisPage[t]).completed&&!o.failed&&l.push(o);l.forEach(function(e){}),this._refetchExistingModels&&(a&&(i=e.merge(i,this._globalEvictionExemptionConfig)),Object.keys(this.modelRegistries).forEach(function(e){r=c[e],(s=i[e])?s.exemptIds?(s.evictIds&&n.warn("Error in eviction config for registry: cannot specify both a whitelist (`evictIds`) and a blacklist (`exemptIds`) for model eviction. Ignoring `evictIds` and evicting all models except those listed in `exemptIds`.",{modelRegistryName:e}),r.removeAllExcept(s.exemptIds)):s.evictIds&&s.evictIds.forEach(function(i){c[e].remove(i)}):c[e].removeAll()}))},markUploadInProgress:function(e){this._uploadInProgress=e},uploadIsInProgress:function(){return this._uploadInProgress},storePendingUploadErrorModal:function(e){this._pendingUploadErrorModal=e},retrievePendingUploadErrorModal:function(e){return this._pendingUploadErrorModal},_doForcedServerRender:function(){if(!YUI.Env.isServer||!this.request||!this.request.headers)return!1;var e=!1;return e=e||this.request.UA.isBot,e=e||this.request.UA.isSharingBot,this.flipper.isFlipped("enable-server-render-for-unsupported-browsers")&&(e=e||this.request.UA.isUnsupportedBrowser),this.flipper.isFlipped("enable-forced-server-render")&&(e=!0),e},getUA:function(){return YUI.Env.isServer?this.request.UA:e.config.flickr.request.UA},logViewTiming:function(){var e,i=this.flapp.get("activeView"),t=0,n=this;e=function(i,o){t++,Object.keys(i.subviews).forEach(function(r){var s=i.subviews[r].get("container").hasClass("requiredToShowOnServer")||i.subviews[r]._params.requiredToShowOnClient,a=o&&s,l="-";l=s?"🔹":"-",l=a?"🔷":l,console.log("| \t\t "+new Array(t).join(" |\t\t ")+" "+l+" "+r+" (initialization: "+n.viewTiming[r].initialize+"ms) (loadState: "+n.viewTiming[r].loadState+"ms)"),e(i.subviews[r],a)}),t--},console.log(this.routeConfig.module+": "+this.routeTiming+"ms"),console.log("🔷 "+i.name+" (initialization: "+this.viewTiming[i.name].initialize+"ms) (loadState: "+this.viewTiming[i.name].loadState+"ms)"),e(i,!0)}}},"@VERSION@",{requires:["oop","flickr-api","flickr-promise","promise","model-import-export","cookie","view-counter","flipper","localizable","moment","experiments-fullscreen","experiments-opt-out","moola-manager","viewport-data","querystring-parse-simple","querystring-stringify-simple","url-helper","browser-support","api-helper","banner-helper"]});YUI.add("querystring-stringify",function(e,t){var n=e.namespace("QueryString"),r=[],i=e.Lang;n.escape=encodeURIComponent,n.stringify=function(e,t,s){var o,u,a,f,l,c,h=t&&t.sep?t.sep:"&",p=t&&t.eq?t.eq:"=",d=t&&t.arrayKey?t.arrayKey:!1;if(i.isNull(e)||i.isUndefined(e)||i.isFunction(e))return s?n.escape(s)+p:"";if(i.isBoolean(e)||Object.prototype.toString.call(e)==="[object Boolean]")e=+e;if(i.isNumber(e)||i.isString(e))return n.escape(s)+p+n.escape(e);if(i.isArray(e)){c=[],s=d?s+"[]":s,f=e.length;for(a=0;a<f;a++)c.push(n.stringify(e[a],t,s));return c.join(h)}for(a=r.length-1;a>=0;--a)if(r[a]===e)throw new Error("QueryString.stringify. Cyclical reference");r.push(e),c=[],o=s?s+"[":"",u=s?"]":"";for(a in e)e.hasOwnProperty(a)&&(l=o+a+u,c.push(n.stringify(e[a],t,l)));return r.pop(),c=c.join(h),!c&&s?s+"=":c}},"3.16.0",{requires:["yui-base"]});
