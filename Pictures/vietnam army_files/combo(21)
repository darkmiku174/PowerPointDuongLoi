YUI.add("hermes-template-photo-limit-overlay",function(e,a){var l=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,l,t,i){var s;return'<div class="photo-limit-overlay '+e.escapeExpression("function"==typeof(s=null!=(s=l.additionalClasses||(null!=a?a.additionalClasses:a))?s:l.helperMissing)?s.call(null!=a?a:{},{name:"additionalClasses",hash:{},data:i}):s)+'">\n\t<div class="panel-container">\n\t</div>\n</div>\n'},useData:!0}),t={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(t[a]=l)}),e.Template.register("hermes/photo-limit-overlay",function(a,i){return i=i||{},i.partials=i.partials?e.merge(t,i.partials):t,l(a,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-limit-panel",function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,a,r){return" active"},3:function(n,e,t,a,r){return" hidden off-right"},5:function(n,e,t,a,r){return'<p class="sub-text">'+n.escapeExpression((t.preventOrphans||e&&e.preventOrphans||t.helperMissing).call(null!=e?e:{},null!=e?e.subText:e,{name:"preventOrphans",hash:{},data:r}))+"</p>"},compiler:[7,">= 4.0.0"],main:function(n,e,t,a,r){var l,s,p=null!=e?e:{},i=t.helperMissing,u=n.escapeExpression;return'<div class="panel'+(null!=(l=t.if.call(p,null!=e?e.initialActive:e,{name:"if",hash:{},fn:n.program(1,r,0),inverse:n.program(3,r,0),data:r}))?l:"")+'" data-panel-index="'+u("function"==typeof(s=null!=(s=t.panelIndex||(null!=e?e.panelIndex:e))?s:i)?s.call(p,{name:"panelIndex",hash:{},data:r}):s)+'">\n\t<div class="panel-content">\n\t\t<h2>'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.title:e,{name:"preventOrphans",hash:{},data:r}))+'</h2>\n\t\t<div class="description-container">\n\t\t\t'+u((t.renderTrustedMarkup||e&&e.renderTrustedMarkup||i).call(p,null!=e?e.description:e,{name:"renderTrustedMarkup",hash:{},data:r}))+'\n\t\t</div>\n\n\t\t<div class="button-container">\n\t\t\t<a href="/account/upgrade/pro?select" class="button accept-button pro-link">'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.acceptButtonText:e,{name:"preventOrphans",hash:{},data:r}))+'</a>\n\t\t\t<button class="button unfluid decline-button">'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.declineButtonText:e,{name:"preventOrphans",hash:{},data:r}))+"</button>\n\t\t</div>\n\n\t\t"+(null!=(l=t.if.call(p,null!=e?e.subText:e,{name:"if",hash:{},fn:n.program(5,r,0),inverse:n.noop,data:r}))?l:"")+"\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/photo-limit-panel",function(e,r){return r=r||{},r.partials=r.partials?n.merge(a,r.partials):a,t(e,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-profile-setProfile-updater",function(e,i){"use strict";e.namespace("ModelUpdaters")["flickr-profile-setProfile"]={run:function(l,r){var t=(function(e){var i={};return i.extras="full_response,expand_bbml,social_urls","profileDescription"===e.field?e.field="description":"website"===e.field&&(e.field="website_url"),i[e.field]=e.value,i})(l);return new e.FlickrPromise({apiResponse:r.callAPI("flickr.profile.setProfile",t),personPublicProfileModel:r.getModel("person-public-profile-models",l.id)}).then(function(e){return(function(e,i,l,r){var t=e.apiResponse,o=e.personPublicProfileModel;if(t){var s=t[l.field],f={stat:t.stat,field:l.field,value:s};return"description"===l.field?(l.field="profileDescription",o.setValue("profileDescription",t.description),o.setValue("profileDescriptionExpanded",t.descriptionExpanded)):"website_url"===l.field?(l.field="website",o.setValue("website",s)):["instagram","facebook","tumblr","pinterest","twitter"].indexOf(l.field)>-1?(o.setValue(l.field,t[l.field]),o.setValue(l.field+"Url",t[l.field+"Url"])):void 0===s?o.setValue(l.field,i[l.field]):o.setValue(l.field,s),f}})(e,t,l)}.bind(this),e.FetcherErrorLogger(i))}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-public-profile-models"]});YUI.add("person-public-profile-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-profile-getProfile"].run(t,this.appContext)},updateField:function(t,r){return e.ModelUpdaters["flickr-profile-setProfile"].run(t,r)}},remoteUpdateDescription:function(e,t,r){return this.setValue(e,"description",t.description),this.remote.updateBioField(t,r)},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}},joinedDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},showcaseSetId:{defaultValue:"0"},city:{},country:{},firstName:{},lastName:{},hometown:{},email:{},occupation:{},profileDescription:{},profileDescriptionExpanded:{},timezone:{},website:{},facebook:{},facebookUrl:{},instagram:{},instagramUrl:{},tumblr:{},tumblrUrl:{},twitter:{},twitterUrl:{},pinterest:{},pinterestUrl:{},totalViews:{},totalTags:{},totalGeotagged:{},totalFaves:{},totalInGroup:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-profile-getProfile-fetcher","flickr-profile-setProfile-updater"]});YUI.add("flickr-profile-getProfile-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-profile-getProfile"]={run:function(t,s){var o=this,i=s.getViewer();return i&&i.signedIn&&(t.id===i.nsid||t.nsid===i.nsid)&&(t.storage=1),new e.FlickrPromise({apiResponse:s.callAPI("flickr.profile.getProfile",this._processParams(t,s),!0),personPublicProfileModelRegistry:s.getModelRegistry("person-public-profile-models")}).then(function(e){return o._processResponse(e,t,s)},e.FetcherErrorLogger(r))},_processParams:function(r,t){var s={datecreate:1};if(s.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&r.id===t.request.probableUser&&(s.storage=1,s.extras+=", classic_user_id, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref",s.extras+=", products_features",s.extras+=", is_minor"),r.extras&&"string"==typeof r.extras&&r.extras.length>0&&(s.extras=s.extras+","+r.extras),r.id)s.user_id=r.id;else{if(!r.pathAlias)throw new Error("`fetch` is missing required params.");s.path_alias=r.pathAlias}return r.storage&&(s.storage=r.storage),s.extras||(s.extras=""),s.extras+=", has_stats,expand_bbml,social_urls",r.hideStats||(s.extras+=",with_stats"),s},_processResponse:function(e,r,t){var s=e.apiResponse,o=e.personPublicProfileModelRegistry,i={};if(s&&s.profile){var a=s.profile,l=s.stats;return i={city:a.city,country:a.country,firstName:a.firstName,lastName:a.lastName,hometown:a.hometown,email:a.email,nsid:a.nsid,id:a.nsid,showcaseSetId:a.showcaseSet||"0",joinedDate:a.join_date,occupation:a.occupation,profileDescription:a.profileDescription,profileDescriptionExpanded:a.profileDescriptionExpanded,website:a.website,twitter:a.twitter,twitterUrl:a.twitterUrl,instagram:a.instagram,instagramUrl:a.instagramUrl,facebook:a.facebook,facebookUrl:a.facebookUrl,tumblr:a.tumblr,tumblrUrl:a.tumblrUrl,pinterest:a.pinterest,pinterestUrl:a.pinterestUrl,totalViews:l?l.photoViews:0,totalTags:l?l.tags:0,totalGeotagged:l?l.geotagged:0,totalFaves:l?l.faves:0,totalInGroup:l?l.groups:0},o.addOrUpdate(i)}}}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-public-profile-models","person-groups-models","photostream-models","api-helper"]});YUI.add("user-limits-helper",function(i){var t=i.config.flickr.account.photo_limit,e=i.config.flickr.account.near_photo_limit;i.UserLimitsHelper={isNearUploadLimit:function(i,o){return o.getViewer().signedIn&&!o.getViewer().isPro&&i.getValue("photoCount")>=e&&i.getValue("photoCount")<t},isAtUploadLimit:function(i,e){return e.getViewer().signedIn&&!e.getViewer().isPro&&i.getValue("photoCount")>=t},isOverUploadLimit:function(i,e){return e.getViewer().signedIn&&!e.getViewer().isPro&&i.getValue("photoCount")>t},isOverARRLimit:function(i,e){return e.getViewer().signedIn&&!e.getViewer().isPro&&this.getARRCount(i)>t},hasReachedNearUploadLimit:function(i,t){return this.isNearUploadLimit(i,t)||this.isAtUploadLimit(i,t)||this.isOverUploadLimit(i,t)},hasReachedUploadLimit:function(i,t){return this.isAtUploadLimit(i,t)||this.isOverUploadLimit(i,t)},remainingAvailableUploads:function(i,t){return t.getValue("uploadLimit")-i.getValue("photoCount")},getARRCount:function(i){var t=i.getValue("arrPhotoCount");return t>=0?t:i.getValue("photoCount")}}},"@VERSION@",{requires:[]});YUI.add("photo-limit-overlay-view",function(e,t){require("hermes-core/flog")(t);var i=require("hermes-core/analytics");e.namespace("Views")[this.name]=e.Base.create("photo-limit-overlay-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(e){this.params=e},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e=this.params.overlayClassList||[];this.setContainerWithTemplate("photo-limit-overlay",{additionalClasses:e.join(" ")})},activate:function(){var t=this,i=this.get("container");if(this.panelContainer=i.one(".panel-container"),this.dismissCookieName=e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name,!this.appContext.getCookie(this.dismissCookieName))return e.Promise.all([this.appContext.getModel("person-public-profile-models",this.appContext.getViewer().nsid).then(function(e){t.publicProfileModel=e}),this.appContext.getModel("person-profile-models",this.appContext.getViewer().nsid).then(function(e){t.profileModel=e})]).then(function(){t.isLoaded=!0,t.fire("loaded")})},show:function(){var t,n,a,l,o,s=this,p=this.get("container"),r="",h=e.config.flickr.account.photo_limit,c=e.UserLimitsHelper.getARRCount(this.profileModel);this.appContext.getCookie(this.dismissCookieName)||(n=parseInt(this.publicProfileModel.getValue("totalViews")),a=parseInt(this.publicProfileModel.getValue("totalFaves")),l=parseInt(this.publicProfileModel.getValue("totalTags")),o=Math.max(c-h,0).toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.RIGHT_NOW_PHOTOS_AT_RISK",count:o}))+"</p>",n>1&&a<=1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS",views:e.IntlNumber.format(n,this.appContext.lang,1)}))+"</p>":n<=1&&a>1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES",faves:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":n>1&&a>1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES",views:e.IntlNumber.format(n,this.appContext.lang,1),faves:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":n<=1&&a<=1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_TAGS",tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n>1&&a<=1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_TAGS",views:e.IntlNumber.format(n,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n<=1&&a>1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES_TAGS",faves:e.IntlNumber.format(a,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n>1&&a>1&&l>1&&(r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES_TAGS",views:e.IntlNumber.format(n,this.appContext.lang,1),faves:e.IntlNumber.format(a,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>"),r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.TAKE_MOMENT_TO_PROTECT_PHOTOS"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:0,title:this.intlMessage({intlName:"upload-blocking.PROTECT_THESE_PHOTOS"}),description:r,acceptButtonText:this.intlMessage({intlName:"upload-blocking.SAVE_YOUR_PHOTOS"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.MARK_PHOTOS_FOR_DELETION_B",count:o}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"}),initialActive:!0})),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.UPGRADE_YOU_ALSO_GET"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:1,title:this.intlMessage({intlName:"upload-blocking.DID_YOU_KNOW_FLICKR_PRO"}),description:r,acceptButtonText:this.intlMessage({intlName:"refencing-announcement.UPGRADE_TO_PRO"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.CONTINUE_WITHOUT_SECURING_PHOTOS_B",count:o}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"})})),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.FLICKR_PROS_LOVE_PHOTOGRAPHY"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:2,title:this.intlMessage({intlName:"upload-blocking.DONT_NEED_TO_BE_PROFESSIONAL"}),description:r,acceptButtonText:this.intlMessage({intlName:"upload-blocking.JOIN_FLICKR_PRO"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.DONT_REMIND_AGAIN_B"})})),t=this.panelContainer.all(".panel"),p.addClass("unhidden"),setTimeout(function(){p.addClass("active")},50),this.panelCount=t?t.size():0,i&&i.tl(!0,"o","Photo Limit Overlay: Show"),this.registerEventHandler(p.delegate("click",function(e){s.handleAcceptClick(e)},".accept-button")),this.registerEventHandler(p.delegate("click",function(e){s.handleDeclineClick(e)},".decline-button")))},hide:function(){var t=this.get("container");t.removeClass("active"),setTimeout(function(){t.removeClass("unhidden"),e.fire("photoLimitOverlay:hidden")},1e3)},showPanel:function(e){var t,i=this.get("container"),n=i.all(".panel"),a=i.one(".panel.active");e<n.size()&&(a.addClass("off-left"),a.removeClass("active"),setTimeout(function(){a.addClass("hidden")},1e3),(t=n.item(e)).removeClass("hidden"),t.addClass("active"),setTimeout(function(){t.removeClass("off-right")},50))},handleAcceptClick:function(t){i&&i.tl(e.one(t.target).getDOMNode(),"o","Photo Limit Overlay: Accept",null,"navigate")},handleDeclineClick:function(t){var n=t.target.ancestor(".panel",!0),a=parseInt(n.getAttribute("data-panel-index"));if(a+1<this.panelCount)this.showPanel(a+1);else{var l=new Date;l.setTime(l.getTime()+36e10),this.appContext.setCookie({cookieName:this.dismissCookieName,cookieValue:1,expires:l,path:"/"}),this.appContext.setCookie({cookieName:e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,cookieValue:1,expires:l,path:"/"}),i&&i.tl(!0,"o","Photo Limit Overlay: Decline"),this.hide()}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-limit-overlay","hermes-template-photo-limit-panel","person-public-profile-models","intl-number","user-limits-helper","string-helper"],langBundles:["upload-blocking","refencing-announcement"]});